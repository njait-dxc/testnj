define(["util","moment","config"],function(a,b,c){var d="agent/email: ";return{onMessage:function(b){console.log(d+b.messageType);try{if("EmailStateChangeMessage"===b.messageType&&"StatusChange"===b.notificationType)switch(console.log(d+"id - "+b.email.id),console.log(d+"state - "+b.email.state),b.email.mediaType="email",b.email.state){case"Processing":console.log(d+"publish email.pop"),a.getInstance("email.pop").publish(b);break;case"Completed":console.log(d+"publish email.ended"),a.getInstance("email.ended").publish(b)}}catch(a){console.error(d+"ERROR - "+a.stack)}}}});