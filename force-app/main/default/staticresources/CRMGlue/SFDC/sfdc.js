define(["jquery","util","Glue","config","SFDC/api","i18next","jqueryI18next","i18nextXHRBackend","SFDC/connected","SFDC/lang"],function(a,b,c,d,e,f,g,h,i,j){function k(a){console.log(q+"start"),p=l(a);var d=o(a);b.getInstance("glue.state").subscribe(function(a){switch(a){case"connecting":console.log(q+"Connecting..."),e.setSoftphoneLabel(f.t("connect.connecting")),e.setSoftphoneStyle("connecting");break;case"connected":console.log(q+"Connected"),e.setSoftphoneLabel(f.t("connect.connected")),e.setSoftphoneStyle("connected"),i.initialize(d);break;case"not connected":console.log(q+"Not Connected"),e.setSoftphoneLabel(f.t("connect.notConnected")),e.setSoftphoneStyle("not connected")}}),c.initialize(p)}function l(a){var b=m(a,"ConnectorSettings","PollPort","5050"),c="true"===m(a,"ConnectorSettings","UseWebSockets","false"),d="true"===m(a,"ConnectorSettings","UseLocalHost","true"),e="true"===m(a,"PopSettings","ShowContact","true"),f="true"===m(a,"PopSettings","NoDefaultSearch","false"),g="true"===m(a,"PopSettings","NoANISearch","false"),h="true"===m(a,"PopSettings","ContactHasFocus","false"),i=m(a,"PopSettings","SearchURL","/apex/CRMDefaultSearch"),j="true"===m(a,"PopSettings","NewTaskNoContactFound","false"),k="true"===m(a,"PopSettings","NewOutboundTaskNoContactFound","false"),l="true"===m(a,"CaseSettings","ShowCase","false"),n="true"===m(a,"CaseSettings","NewCaseOnPop","false"),o="true"===m(a,"CaseSettings","NewCaseIfNoSearchKVPPresent","false");return{pollPort:b,useWebSockets:c,useLocalhost:d,showContact:e,noDefaultSearch:f,noANISearch:g,contactHasFocus:h,searchURL:i,newTaskNoContactFound:j,newOutboundTaskNoContactFound:k,showCase:l,newCaseOnPop:n,searchCaseIfWrongCase:"true"===m(a,"CaseSettings","SearchCaseIfWrongCase","false"),newCaseIfNoSearchKVPPresent:o,openNewCaseInEditMode:"true"===m(a,"CaseSettings","OpenNewCaseInEditMode","false"),openExistingCaseInEditMode:"true"===m(a,"CaseSettings","OpenExistingCaseInEditMode","false"),createTask:"true"===m(a,"TaskSettings","CreateTask","false"),newTaskOnPop:"true"===m(a,"TaskSettings","NewTaskOnPop","false"),openInitialTaskInEditMode:"true"===m(a,"TaskSettings","OpenInitialTaskInEditMode","false"),openFinalTaskInEditMode:"true"===m(a,"TaskSettings","OpenFinalTaskInEditMode","false"),hideTask:"true"===m(a,"TaskSettings","HideTask","false"),caseMap:m(a,"DataMapping","CaseMap",""),taskMap:m(a,"DataMapping","TaskMap",""),dispositionKVP:m(a,"DataMapping","DispositionKVP")}}function m(a,b,c,d){var e=a["/"+b+"/"+c];return e?(console.log("getOption: "+b+" "+c+": "+e),e):(console.log("getOption: "+b+" "+c+" (default): "+d),d)}function n(a,b,c){return m(a,"FieldSearchSettings",b,c)}function o(a){return{voiceSearchType:n(a,"VoiceSearchType","phoneNumber"),emailSearchType:n(a,"EmailSearchType","email"),chatSearchType:n(a,"ChatSearchType","name"),openmediaSearchType:n(a,"OpenMediaSearchType","name"),searchCaseKVP:n(a,"SearchCaseKVP","CaseNumber")}}var p,q="SFDC/sfdc: ",r=!1;return{initialize:function(b,c,d){var i=a.Deferred();e.initialize(d);try{console.log(q+"initialize ("+b+")");var l=window.navigator.userLanguage||window.navigator.language;console.log(q+"lang="+l),r?sforce.console.isInConsole()&&(console.log(q+"in console"),k(c),i.resolve()):f.use(h).init({debug:!0,lng:l,fallbackLng:"en",backend:{loadPath:b+"locales/{{lng}}.json"}},function(){g.init(f,a),r=!0,a("body").localize(),j.initialize(),sforce.console.isInConsole()?(console.log(q+"in console"),k(c),i.resolve(f)):(console.log(q+"NOT in Salesforce console."),i.reject())})}catch(a){console.error(q+"ERROR - "+a.stack),i.reject()}return i.promise()},terminate:function(){console.log(q+"terminate"),c.terminate()}}});